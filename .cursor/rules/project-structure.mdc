---
description: 
globs: 
alwaysApply: true
---

# ðŸ§  LoopList Full-Stack Development Guide

## ðŸ§­ Development Philosophy

- **Clean & Modular Code**: Adhere to SOLID principles for maintainability.
- **Functional Programming**: Favor functional and declarative patterns over imperative ones.
- **Type Safety**: Utilize TypeScript extensively for type safety.
- **Component-Driven Development**: Build reusable and composable components.
- **Progressive Enhancement**: Design with PWA capabilities in mind from the start.

---

## ðŸ“ Folder Structure

```
project-root/
â”œâ”€â”€ app/                   # Next.js App Router
â”‚   â”œâ”€â”€ api/               # API routes
â”‚   â”œâ”€â”€ (auth)/            # Authentication routes
â”‚   â”œâ”€â”€ (dashboard)/       # Dashboard routes
â”‚   â””â”€â”€ layout.tsx         # Root layout
â”œâ”€â”€ components/            # Reusable components
â”‚   â”œâ”€â”€ ui/                # UI components
â”‚   â”œâ”€â”€ forms/             # Form components
â”‚   â””â”€â”€ layout/            # Layout components
â”œâ”€â”€ hooks/                 # Custom React hooks
â”œâ”€â”€ lib/                   # Utility functions and libraries
â”‚   â”œâ”€â”€ api/               # API utilities
â”‚   â”œâ”€â”€ utils/             # General utilities
â”‚   â””â”€â”€ db/                # Database utilities
â”œâ”€â”€ models/                # Mongoose models
â”œâ”€â”€ public/                # Static assets
â”‚   â”œâ”€â”€ manifest.json      # PWA manifest
â”‚   â””â”€â”€ service-worker.js  # PWA service worker
â”œâ”€â”€ store/                 # Zustand stores
â”‚   â”œâ”€â”€ slices/            # Store slices
â”‚   â””â”€â”€ index.ts           # Store exports
â”œâ”€â”€ styles/                # Global styles
â”œâ”€â”€ types/                 # TypeScript type definitions
â””â”€â”€ middleware.ts          # Next.js middleware
```

---

## ðŸ§± Feature Implementation

### 1. Create Loop

**Description**: Allow users to create recurring micro-habits (loops) with customizable settings.

**Implementation**:

- **UI**: `components/forms/CreateLoopForm.tsx`
  - Fields:
    - Loop Title (e.g., "Read 10 pages")
    - Frequency: Daily / 3x per week / Weekdays / Custom
    - Start Date
    - Visibility: Private, Public, Friends only
    - Optional emoji icon or cover image
- **State Management**: `store/slices/loopSlice.ts`
  - Actions:
    - `createLoop`: Handles API call to create a new loop.
- **API Route**: `app/api/loops/route.ts`
  - Method: `POST`
  - Validates input and saves the loop to MongoDB using Mongoose.
- **Model**: `models/Loop.ts`
  - Fields:
    - title: string
    - frequency: string
    - startDate: Date
    - visibility: enum
    - icon: string (optional)
    - userId: ObjectId (reference to User)

### 2. Track Your Streak

**Description**: Enable users to track their daily progress and visualize their habit streaks.

**Implementation**:

- **UI**: `components/ui/LoopTracker.tsx`
  - Displays:
    - Current streak
    - Longest streak
    - Completion rate
    - Loop heatmap calendar (inspired by GitHub)
  - Allows users to mark daily completion.
- **State Management**: `store/slices/loopSlice.ts`
  - Actions:
    - `markCompletion`: Marks a loop as completed for the day.
    - `fetchLoopStats`: Retrieves loop statistics.
- **API Routes**:
  - `app/api/loops/[id]/complete/route.ts`
    - Method: `POST`
    - Marks the loop as completed for the current day.
  - `app/api/loops/[id]/stats/route.ts`
    - Method: `GET`
    - Returns current streak, longest streak, and completion rate.
- **Model Update**: `models/Loop.ts`
  - Add fields:
    - completions: array of Dates
    - currentStreak: number
    - longestStreak: number

### 3. Public Loop Boards

**Description**: Allow users to view and interact with public loops created by others.

**Implementation**:

- **UI**: `components/ui/PublicLoopBoard.tsx`
  - Displays a list/grid of public loops.
  - Features:
    - "Cheer" with an emoji reaction
    - "Clone this loop" to add it to the user's own loops
    - Display count of users participating
- **State Management**: `store/slices/publicLoopSlice.ts`
  - Actions:
    - `fetchPublicLoops`: Retrieves public loops.
    - `cheerLoop`: Adds a cheer reaction to a loop.
    - `cloneLoop`: Clones a public loop for the current user.
- **API Routes**:
  - `app/api/public-loops/route.ts`
    - Method: `GET`
    - Returns a list of public loops.
  - `app/api/public-loops/[id]/cheer/route.ts`
    - Method: `POST`
    - Adds a cheer to the specified loop.
  - `app/api/public-loops/[id]/clone/route.ts`
    - Method: `POST`
    - Clones the specified loop for the current user.

---

## ðŸ§ª State Management with Zustand

**Structure**:

- Each feature has its own slice within `store/slices/`.
- Example: `store/slices/loopSlice.ts`

```typescript
import { create } from 'zustand'
import { immer } from 'zustand/middleware/immer'

interface LoopState {
  loops: Loop[]
  createLoop: (data: LoopInput) => Promise<void>
  markCompletion: (loopId: string) => Promise<void>
  fetchLoopStats: (loopId: string) => Promise<LoopStats>
}

export const useLoopStore = create<LoopState>()(
  immer((set) => ({
    loops: [],
    createLoop: async (data) => {
      // API call to create loop
    },
    markCompletion: async (loopId) => {
      // API call to mark completion
    },
    fetchLoopStats: async (loopId) => {
      // API call to fetch stats
    },
  }))
)
```

---

## ðŸ§° Utilities and Helpers

- **API Utilities**: `lib/api/`
  - Functions to handle API calls, e.g., `createLoop`, `markCompletion`.
- **Date Utilities**: `lib/utils/date.ts`
  - Functions for date calculations, e.g., calculating streaks.
- **Validation**: Use Zod schemas for input validation in API routes.

---

## ðŸ§ª Testing

- **Unit Tests**: Use Jest for testing utility functions and store slices.
- **Integration Tests 